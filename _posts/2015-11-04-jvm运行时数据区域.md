---
layout: post
title: "JVM运行时数据区域"
date: 2015-11-04
categories: java
---


#JVM运行时数据区域


###程序计数器

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;java虚拟机中的多线程是通过**时间片轮转法**来切换的，在任何一个时刻，一个处理器都会执行一条线程中的指令。为了线程切换后能够正确的恢复，所以就需要一个程序计数器。程序计数器是一个较小的内存空间，用来指示当前线程执行的字节码的行号，字节码解释器工作时就是通过程序计数器去选择下一个需要执行得字节码指令。正因为每个线程都有一个程序计数器，所以程序计数器是**线程私有**的。  
<pre>
作用：用来指示当前线程执行得字节码行号
</pre>
<pre>
存储内容：计数器
</pre>
<pre>
可能抛出的异常：
无
</pre>


###Java虚拟机栈

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;java虚拟机栈也是**线程私有**的，生命周期与线程相同。**虚拟机栈为虚拟机执行得Java方法服务**。Java中的每个方法在执行得时候都会创建一个栈帧，栈帧用于存储以下信息：
* 局部变量表
* 操作数栈
* 动态链接
* 方法出口等信息

线程中，每个方法从调用到执行完成，都对应着一个栈帧在当前线程的虚拟机栈的入栈和出栈过程
<pre>
作用：存储Java方法对应的栈帧，方法的调用和执行完成对应栈帧的入栈和出栈
</pre>
<pre>
存储内容：局部变量表、操作数栈、动态链接、方法出口
</pre>
<pre>
可能出现的异常：
StackOverFlowError: 请求的栈深度大于虚拟机允许的深度
OutOfMemoryError:如果虚拟机栈可以动态扩展，扩展时无法申请到足够的内存时
</pre>

###本地方法栈

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本地方法栈和虚拟机方法栈的作用类似，**本地方法栈为虚拟机使用到的Native方法服务**。
<pre>
作用：存储Native方法对应的栈帧，方法的调用和执行对应栈帧的入栈和出栈
</pre>
<pre>
可能出现的异常
StackOverFlowError
OutOfMemoryError
</pre>

###Java堆

Java堆是被**所有线程共享**的一块内存区域，虚拟机启动时就创建Java堆，Java堆的作用是存放Java对象的**实例**和**数组**，它也是垃圾回收器管理的主要区域。在JDK1.7中，内存回收基本都是采用的分代回收，所以Java堆还可以细分为**新生代**和**老年代**，再细致的分法为**Eden空间**、**From Survivor空间**、**To Survivor空间**等

<pre>
作用：存放Java对象的实例和数组
</pre>
<pre>
存储内容：Java对象实例、数组
</pre>
<pre>
可能出现的异常：
OutOfMemoryError：堆中没有内存完成实例的分配
</pre>

###方法区

方法区是各个**线程共享**的区域,它用于存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。在Java虚拟机中，方法区可以选择不实现垃圾回收。

**运行时常量池**是方法区的一部分，Class文件除了有类的版本、字段、方法、接口等信息，还有一个信息是**常量池**，用于存放编译期生成的各种字面量和符号引用，这部分内容将在类加载后进入方法区的运行时常量池。
<pre>
作用：用于存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码
</pre>
<pre>
存储内容：类信息、常量、静态变量、即时编译后的代码
</pre>
<pre>
可能抛出的异常：
OutOfMemoryError：当内存无法满足方法区的需求时
</pre>

###直接内存

直接内存并不是虚拟机运行时数据区域的一部分，也不是java虚拟机规范中定义的内存区域，但是这部分内存会被频繁的使用，也可能导致OutOfMemoryError。`NIO`类引入了基于通道与缓冲区的I/O方式，它可以使用Native函数库直接分配堆外内存，然后通过存储在Java堆中的`DirectByteBuffer`对象作为这块内存的引用进行操作。目的是避免在Java堆和Native堆中来回复制数据。
<pre>
作用：避免在Java堆和Native堆中来回复制数据
</pre>
<pre>
可能出现的异常：
OutOfMemoryError：配置内存时，忽略直接内存，使得内存总和大于物理内存限制，导致动态扩展时出现此异常
</pre>

